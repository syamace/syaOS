<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architecture & Build - syaOS Docs</title>
  <link rel="icon" href="/icons/mac-192.png">
  <style>
    @font-face { font-family: "Geneva"; src: url("/fonts/geneva-12.woff2") format("woff2"); }
    @font-face { font-family: "Monaco"; src: url("/fonts/monacottf.woff2") format("woff2"); }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Geneva", system-ui, sans-serif;
      font-size: 12px;
      line-height: 1.5;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #fff;
      color: #000;
    }
    a { color: #00f; }
    a:hover { text-decoration: none; }
    code, pre { font-family: "Monaco", monospace; font-size: 11px; }
    code { background: #f0f0f0; padding: 1px 4px; }
    pre { background: #f8f8f8; border: 1px solid #ddd; padding: 12px; overflow-x: auto; margin: 12px 0; }
    pre code { background: none; padding: 0; }
    
    /* Layout */
    .header {
      position: sticky; top: 0; z-index: 10;
      background: #fff; border-bottom: 1px solid #ccc;
      padding: 0 16px; height: 40px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .header-left { display: flex; align-items: center; gap: 8px; }
    .header-left img { width: 20px; height: 20px; display: block; }
    .header-left span { font-weight: bold; }
    .header-right { display: flex; align-items: center; gap: 16px; }
    .header-right a { text-decoration: none; color: #333; }
    .header-right a:hover { color: #000; }
    .header-right .github { display: flex; align-items: center; gap: 4px; }
    .header-right .launch { background: #000; color: #fff; padding: 4px 12px; }
    
    .container { display: flex; max-width: 1100px; margin: 0 auto; }
    
    .sidebar {
      width: 220px; flex-shrink: 0;
      border-right: 1px solid #ccc;
      padding: 12px;
      position: sticky; top: 40px;
      height: calc(100vh - 40px);
      overflow-y: auto;
    }
    .sidebar a {
      display: block; padding: 4px 8px; margin: 2px 0;
      text-decoration: none; color: #333;
      font-size: 11px;
    }
    .sidebar a:hover { background: #f0f0f0; }
    .sidebar a.active { background: #000; color: #fff; }
    
    /* Tree hierarchy styles */
    .nav-group { margin: 4px 0; }
    .nav-spacer { width: 8px; flex-shrink: 0; } /* Same width as toggle arrow */
    .nav-no-toggle { cursor: default; }
    .nav-toggle {
      display: flex; align-items: center; gap: 4px;
      background: none; border: none; padding: 0; width: 100%;
      cursor: pointer; text-align: left; font: inherit; color: inherit;
    }
    .nav-toggle:hover { background: #f0f0f0; }
    .nav-toggle svg { flex-shrink: 0; opacity: 0.6; transition: transform 0.2s; }
    .nav-toggle a { flex: 1; padding: 4px 8px; margin: 0; pointer-events: auto; font-size: 11px; }
    .nav-children { margin-left: 12px; overflow: hidden; transition: height 0.2s ease-out; }
    .nav-child { padding-left: 8px !important; font-size: 10px !important; color: #555 !important; }
    .nav-child:hover { color: #000 !important; }
    .nav-child.active { color: #fff !important; }
    
    .content { flex: 1; padding: 24px 32px; min-width: 0; }
    
    /* Typography */
    h1 { font-size: 18px; border-bottom: 1px solid #ccc; padding-bottom: 8px; margin-bottom: 16px; }
    hr { border: none; border-top: 1px solid #ccc; margin: 16px 0; }
    h2 { font-size: 14px; margin: 24px 0 12px; }
    h3 { font-size: 12px; margin: 16px 0 8px; }
    h4 { font-size: 11px; margin: 12px 0 6px; font-weight: bold; }
    p { margin: 8px 0; }
    ul, ol { margin: 8px 0 8px 20px; }
    li { margin: 4px 0; }
    
    /* Tables */
    table { width: 100%; border-collapse: collapse; margin: 12px 0; font-size: 11px; }
    th, td { border: 1px solid #ccc; padding: 6px 8px; text-align: left; }
    th { background: #f0f0f0; font-weight: bold; }
    
    /* Mermaid diagrams */
    pre.mermaid { background: none; border: none; padding: 0; text-align: center; margin: 16px 0; }
    .mermaid svg { max-width: 100%; height: auto; font-family: "Geneva", system-ui, sans-serif !important; }
    .mermaid .node rect, .mermaid .node circle, .mermaid .node polygon { fill: #f8f8f8 !important; stroke: #ccc !important; }
    .mermaid .edgeLabel { background: #fff !important; font-size: 10px !important; }
    .mermaid .label { font-size: 10px !important; }
    .mermaid .nodeLabel { font-size: 10px !important; }
    .mermaid .cluster-label { font-size: 10px !important; }
    .mermaid .messageText { font-size: 10px !important; }
    .mermaid .actor { font-size: 10px !important; }
    .mermaid .labelText { font-size: 10px !important; }
    
    /* Collapsible details */
    details { margin: 8px 0; }
    details summary { 
      cursor: pointer; 
      color: #666; 
      font-size: 11px;
      padding: 4px 0;
      user-select: none;
    }
    details summary:hover { color: #000; }
    details[open] summary { margin-bottom: 8px; }
    details ul { margin-top: 0; }
    
    /* Navigation */
    .nav { display: flex; justify-content: space-between; margin-top: 32px; padding-top: 16px; border-top: 1px solid #ccc; }
    .nav a { text-decoration: none; color: #333; }
    .nav a:hover { color: #000; }
    
    /* Mobile menu button */
    .menu-btn { 
      display: none; 
      background: transparent; 
      border: 0; 
      padding: 4px; 
      cursor: pointer; 
      line-height: 1;
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
      color: inherit;
    }
    .menu-btn svg { display: block; width: 18px; height: 18px; pointer-events: none; }
    @media screen and (max-width: 768px) {
      .menu-btn { 
        display: -webkit-flex !important;
        display: flex !important; 
        -webkit-align-items: center;
        align-items: center; 
        -webkit-justify-content: center;
        justify-content: center;
      }
      .header-left img { display: none !important; }
      .sidebar { 
        position: fixed; left: -240px; top: 40px; 
        width: 240px; height: calc(100vh - 40px);
        background: #fff; z-index: 20;
        transition: left 0.2s;
      }
      .sidebar.open { left: 0; box-shadow: 2px 0 8px rgba(0,0,0,0.1); }
      .content { padding: 16px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="header-left">
      <button class="menu-btn" onclick="document.querySelector('.sidebar').classList.toggle('open')">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
      </button>
      <a href="/" style="display:flex;align-items:center;gap:8px;text-decoration:none;color:inherit">
        <img src="/icons/mac-192.png" alt="syaOS" width="20" height="20">
        <span>syaOS</span>
      </a>
      <span style="color:#999">/</span>
      <span style="color:#666">Docs</span>
    </div>
    <div class="header-right">
      <a href="https://github.com/syamace/syaOS" target="_blank" class="github">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
        GitHub
      </a>
      <a href="/" class="launch">Launch</a>
    </div>
  </header>
  
  <div class="container">
    <nav class="sidebar">
      <div class="nav-group expanded">
  <button class="nav-toggle" onclick="toggleNavGroup(this)" aria-expanded="true">
    <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="transition: transform 0.2s; transform: rotate(90deg);">
      <path d="M2 0v8l4-4z"/>
    </svg>
    <a href="/docs/overview" class="">1. Overview</a>
  </button>
  <div class="nav-children" style="display: block;">
    <a href="/docs/architecture" class="nav-child active">1.1 Architecture & Build</a>
    <a href="/docs/api-architecture" class="nav-child ">1.2 API Architecture</a>
  </div>
</div>
<div class="nav-group ">
  <button class="nav-toggle" onclick="toggleNavGroup(this)" aria-expanded="false">
    <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="transition: transform 0.2s; transform: rotate(0deg);">
      <path d="M2 0v8l4-4z"/>
    </svg>
    <a href="/docs/apps" class="">2. Apps</a>
  </button>
  <div class="nav-children" style="display: none;">
    <a href="/docs/chats" class="nav-child ">2.1 Chats</a>
    <a href="/docs/internet-explorer" class="nav-child ">2.2 Internet Explorer</a>
    <a href="/docs/ipod" class="nav-child ">2.3 iPod</a>
    <a href="/docs/karaoke" class="nav-child ">2.4 Karaoke</a>
    <a href="/docs/textedit" class="nav-child ">2.5 TextEdit</a>
    <a href="/docs/finder" class="nav-child ">2.6 Finder</a>
    <a href="/docs/paint" class="nav-child ">2.7 Paint</a>
    <a href="/docs/photo-booth" class="nav-child ">2.8 Photo Booth</a>
    <a href="/docs/terminal" class="nav-child ">2.9 Terminal</a>
    <a href="/docs/control-panels" class="nav-child ">2.10 Control Panels</a>
    <a href="/docs/soundboard" class="nav-child ">2.11 Soundboard</a>
    <a href="/docs/synth" class="nav-child ">2.12 Synth</a>
    <a href="/docs/videos" class="nav-child ">2.13 Videos</a>
    <a href="/docs/minesweeper" class="nav-child ">2.14 Minesweeper</a>
    <a href="/docs/virtual-pc" class="nav-child ">2.15 Virtual PC</a>
    <a href="/docs/admin" class="nav-child ">2.16 Admin</a>
    <a href="/docs/applet-store" class="nav-child ">2.17 Applet Store</a>
  </div>
</div>
<div class="nav-group ">
  <button class="nav-toggle" onclick="toggleNavGroup(this)" aria-expanded="false">
    <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="transition: transform 0.2s; transform: rotate(0deg);">
      <path d="M2 0v8l4-4z"/>
    </svg>
    <a href="/docs/application-framework" class="">3. Application Framework</a>
  </button>
  <div class="nav-children" style="display: none;">
    <a href="/docs/window-management" class="nav-child ">3.1 Window Management</a>
    <a href="/docs/state-management" class="nav-child ">3.2 State Management</a>
    <a href="/docs/theme-system" class="nav-child ">3.3 Theme System</a>
    <a href="/docs/hooks-architecture" class="nav-child ">3.4 Hooks Architecture</a>
    <a href="/docs/component-architecture" class="nav-child ">3.5 Component Architecture</a>
  </div>
</div>
<div class="nav-group">
  <div class="nav-toggle nav-no-toggle">
    <span class="nav-spacer"></span>
    <a href="/docs/ai-system" class="">4. AI System</a>
  </div>
</div>
<div class="nav-group">
  <div class="nav-toggle nav-no-toggle">
    <span class="nav-spacer"></span>
    <a href="/docs/file-system" class="">5. File System</a>
  </div>
</div>
<div class="nav-group">
  <div class="nav-toggle nav-no-toggle">
    <span class="nav-spacer"></span>
    <a href="/docs/audio-system" class="">6. Audio System</a>
  </div>
</div>
<div class="nav-group ">
  <button class="nav-toggle" onclick="toggleNavGroup(this)" aria-expanded="false">
    <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="transition: transform 0.2s; transform: rotate(0deg);">
      <path d="M2 0v8l4-4z"/>
    </svg>
    <a href="/docs/ui-components" class="">7. UI Components and Shared Systems</a>
  </button>
  <div class="nav-children" style="display: none;">
    <a href="/docs/component-library" class="nav-child ">7.1 Components</a>
    <a href="/docs/i18n" class="nav-child ">7.2 i18n & Hooks</a>
  </div>
</div>
<div class="nav-group ">
  <button class="nav-toggle" onclick="toggleNavGroup(this)" aria-expanded="false">
    <svg width="8" height="8" viewBox="0 0 8 8" fill="currentColor" style="transition: transform 0.2s; transform: rotate(0deg);">
      <path d="M2 0v8l4-4z"/>
    </svg>
    <a href="/docs/api-reference" class="">8. API Reference</a>
  </button>
  <div class="nav-children" style="display: none;">
    <a href="/docs/chat-api" class="nav-child ">8.1 Chat API</a>
    <a href="/docs/song-api" class="nav-child ">8.2 Song API</a>
    <a href="/docs/media-api" class="nav-child ">8.3 Media API</a>
    <a href="/docs/chat-rooms-api" class="nav-child ">8.4 Chat Rooms API</a>
    <a href="/docs/ai-generation-apis" class="nav-child ">8.5 AI Endpoints</a>
    <a href="/docs/utility-apis" class="nav-child ">8.6 Utility APIs</a>
  </div>
</div>
<div class="nav-group">
  <div class="nav-toggle nav-no-toggle">
    <span class="nav-spacer"></span>
    <a href="/docs/changelog" class="">9. Changelog</a>
  </div>
</div>
    </nav>
    
    <main class="content">
      <article>
        <h1>Architecture & Build</h1>
<p>Vite + Bun build system with multiple deployment targets and optimized chunk splitting for performance.</p>
<h2>System Architecture Overview</h2>
<pre class="mermaid">graph TB
    subgraph Client["Client Layer"]
        Browser[Browser / PWA]
        Desktop[Tauri Desktop App]
    end
    
    subgraph Presentation["Presentation Layer"]
        Apps[17 App Modules]
        Layout[Layout Components]
        UI[UI Components]
        Themes[4 OS Themes]
    end
    
    subgraph State["State Layer"]
        Zustand[21 Zustand Stores]
        Contexts[React Contexts]
    end
    
    subgraph Persistence["Persistence Layer"]
        LocalStorage[(localStorage)]
        IndexedDB[(IndexedDB)]
    end
    
    subgraph API["API Layer (Vercel Edge)"]
        Chat[Chat API]
        Media[Media APIs]
        Rooms[Chat Rooms API]
        Utility[Utility APIs]
    end
    
    subgraph External["External Services"]
        AI[AI Providers<br/>OpenAI, Anthropic, Google]
        Pusher[Pusher<br/>Real-time]
        Redis[(Upstash Redis)]
        YouTube[YouTube API]
    end
    
    Browser --> Presentation
    Desktop --> Presentation
    Presentation --> State
    State --> Persistence
    Presentation --> API
    API --> External
    State --> API</pre>
<h2>Deployment Targets</h2>
<table><thead><tr><th>Target</th><th>Technology</th><th>Description</th></tr></thead><tbody><tr><td><strong>Web (PWA)</strong></td><td>Vercel</td><td>Primary deployment with CDN, edge functions</td></tr><tr><td><strong>Desktop</strong></td><td>Tauri</td><td>Native app for macOS, Windows, Linux</td></tr><tr><td><strong>Development</strong></td><td>Vite</td><td>Local server with HMR</td></tr></tbody></table>
<pre class="mermaid">graph LR
    subgraph Source
        A[Source Code]
    end
    
    subgraph Build["Vite + Bun"]
        B[Bundle & Optimize]
    end
    
    subgraph Targets
        C[Web PWA]
        D[Desktop]
        E[Dev Server]
    end
    
    A --> B
    B --> C
    B --> D
    B --> E
    
    C --> F[Vercel CDN]
    D --> G[Tauri - macOS/Windows/Linux]
    E --> H[localhost + HMR]</pre>
<h2>Chunk Splitting Strategy</h2>
<p>The build system uses intelligent chunk splitting to optimize initial load time while enabling on-demand loading of heavy dependencies.</p>
<h3>Core Chunks (Immediate Load)</h3>
<p>These chunks are loaded on initial page load:</p>
<table><thead><tr><th>Chunk</th><th>Packages</th><th>Size</th></tr></thead><tbody><tr><td><code>react</code></td><td>react, react-dom</td><td>~150KB</td></tr><tr><td><code>ui-core</code></td><td>@radix-ui/<em> (dialog, dropdown, select, etc.)</td><td>~80KB</td></tr><tr><td><code>zustand</code></td><td>zustand, persist middleware</td><td>~10KB</td></tr><tr><td><code>motion</code></td><td>framer-motion</td><td>~100KB</td></tr></tbody></table>
<h3>Deferred Chunks (Lazy Load)</h3>
<p>These chunks are loaded when their corresponding apps are opened:</p>
<table><thead><tr><th>Chunk</th><th>Contents</th><th>Trigger Apps</th></tr></thead><tbody><tr><td><code>audio</code></td><td>tone.js, wavesurfer.js</td><td>Soundboard, iPod, Synth</td></tr><tr><td><code>tiptap</code></td><td>@tiptap/</em> (editor framework)</td><td>TextEdit</td></tr><tr><td><code>three</code></td><td>three.js (3D rendering)</td><td>Virtual PC</td></tr><tr><td><code>ai-sdk</code></td><td>ai, @ai-sdk/*</td><td>Chats, Internet Explorer</td></tr></tbody></table>
<pre class="mermaid">graph TD
    subgraph Core["Core Chunks (Immediate)"]
        R[react]
        UI[ui-core]
        Z[zustand]
        M[motion]
    end
    
    subgraph Deferred["Deferred Chunks (Lazy)"]
        AU[audio]
        TT[tiptap]
        TH[three]
        AI[ai-sdk]
    end
    
    subgraph Apps
        SB[Soundboard]
        IP[iPod]
        SY[Synth]
        TE[TextEdit]
        PC[Virtual PC]
        CH[Chats]
        IE[Internet Explorer]
    end
    
    SB -.->|"on open"| AU
    IP -.->|"on open"| AU
    SY -.->|"on open"| AU
    TE -.->|"on open"| TT
    PC -.->|"on open"| TH
    CH -.->|"on open"| AI
    IE -.->|"on open"| AI</pre>
<h3>Lazy Component Pattern</h3>
<p>Apps use React's lazy loading with a custom wrapper for HMR compatibility:</p>
<pre><code>// Lazy loading with caching for HMR
function createLazyComponent&lt;T = unknown&gt;(
  importFn: () =&gt; Promise&lt;{ default: ComponentType&lt;AppProps&lt;T&gt;&gt; }&gt;,
  cacheKey: string
): ComponentType&lt;AppProps&lt;T&gt;&gt; {
  // Return cached component if exists (prevents HMR issues)
  const cached = lazyComponentCache.get(cacheKey);
  if (cached) return cached;

  const LazyComponent = lazy(importFn);
  
  const WrappedComponent = (props: AppProps&lt;T&gt;) =&gt; (
    &lt;Suspense fallback={null}&gt;
      &lt;LazyComponent {...props} /&gt;
      &lt;LoadSignal instanceId={props.instanceId} /&gt;
    &lt;/Suspense&gt;
  );
  
  lazyComponentCache.set(cacheKey, WrappedComponent);
  return WrappedComponent;
}</code></pre>
<h2>PWA Caching Strategy</h2>
<p>The service worker implements different caching strategies based on resource type:</p>
<table><thead><tr><th>Resource Pattern</th><th>Strategy</th><th>TTL</th><th>Rationale</th></tr></thead><tbody><tr><td>Navigation (HTML)</td><td>NetworkFirst</td><td>1 day</td><td>Always get latest app shell</td></tr><tr><td>JS Chunks</td><td>NetworkFirst (3s timeout)</td><td>1 day</td><td>Fresh code with fast fallback</td></tr><tr><td>CSS</td><td>StaleWhileRevalidate</td><td>7 days</td><td>Use cached, update in background</td></tr><tr><td>Images</td><td>CacheFirst</td><td>30 days</td><td>Rarely change, prioritize speed</td></tr><tr><td>Fonts</td><td>CacheFirst</td><td>1 year</td><td>Never change once deployed</td></tr><tr><td>API Responses</td><td>NetworkOnly</td><td>-</td><td>Always fresh data</td></tr></tbody></table>
<h3>Cache Invalidation</h3>
<pre class="mermaid">sequenceDiagram
    participant SW as Service Worker
    participant Cache as Cache Storage
    participant Network as Network
    participant App as Application
    
    App->>SW: Request resource
    alt CacheFirst (images, fonts)
        SW->>Cache: Check cache
        Cache-->>SW: Return if exists
        SW->>App: Serve from cache
    else NetworkFirst (JS, HTML)
        SW->>Network: Fetch (with timeout)
        alt Success within timeout
            Network-->>SW: Response
            SW->>Cache: Update cache
            SW->>App: Serve response
        else Timeout/Failure
            SW->>Cache: Fallback to cache
            Cache-->>SW: Cached response
            SW->>App: Serve cached
        end
    else StaleWhileRevalidate (CSS)
        SW->>Cache: Get cached version
        Cache-->>SW: Cached response
        SW->>App: Serve immediately
        SW->>Network: Fetch update (background)
        Network-->>SW: Fresh response
        SW->>Cache: Update cache
    end</pre>
<h2>Module Resolution</h2>
<p>The project uses TypeScript path aliases for clean imports:</p>
<table><thead><tr><th>Alias</th><th>Path</th><th>Usage</th></tr></thead><tbody><tr><td><code>@/</code></td><td><code>src/</code></td><td>Source code root</td></tr><tr><td><code>@/components</code></td><td><code>src/components/</code></td><td>UI components</td></tr><tr><td><code>@/hooks</code></td><td><code>src/hooks/</code></td><td>Custom hooks</td></tr><tr><td><code>@/stores</code></td><td><code>src/stores/</code></td><td>Zustand stores</td></tr><tr><td><code>@/apps</code></td><td><code>src/apps/</code></td><td>App modules</td></tr><tr><td><code>@/utils</code></td><td><code>src/utils/</code></td><td>Utility functions</td></tr><tr><td><code>@/lib</code></td><td><code>src/lib/</code></td><td>Libraries</td></tr><tr><td><code>@/types</code></td><td><code>src/types/</code></td><td>TypeScript types</td></tr></tbody></table>
<h2>Environment Configuration</h2>
<h3>Development</h3>
<pre><code># Local development with HMR
bun run dev           # Vite dev server
bun run dev:vercel    # Vercel CLI (recommended for API routes)</code></pre>
<h3>Production Build</h3>
<pre><code>bun run build         # Production build
bun run preview       # Preview production build</code></pre>
<h3>Desktop (Tauri)</h3>
<pre><code>bun run tauri:dev     # Development with native shell
bun run tauri:build   # Build native applications</code></pre>
<h2>Performance Optimizations</h2>
<h3>Initial Load Optimizations</h3>
<ol><li><strong>Code Splitting</strong>: Apps loaded on-demand via React.lazy</li></ol><ol><li><strong>Font Loading</strong>: System font stacks with web font fallbacks</li><li><strong>Image Optimization</strong>: Responsive images, WebP format</li><li><strong>CSS Layers</strong>: Tailwind with theme-specific overrides</li></ol>
<h3>Runtime Optimizations</h3>
<ol><li><strong>Zustand Selectors</strong>: Fine-grained subscriptions prevent re-renders</li></ol><ol><li><strong>Memo/Callback</strong>: Strategic memoization for expensive computations</li><li><strong>Virtual Lists</strong>: Large lists use virtualization (iPod, Finder)</li><li><strong>Debounced Actions</strong>: User inputs debounced for performance</li></ol>
<h3>Audio Optimizations</h3>
<ol><li><strong>Shared AudioContext</strong>: Single context prevents resource exhaustion</li></ol><ol><li><strong>Lazy AudioBuffer Loading</strong>: Sounds loaded on first interaction</li><li><strong>LRU Cache</strong>: Limited audio buffer cache with eviction</li><li><strong>Concurrent Source Limiting</strong>: Prevents audio overload</li></ol>
<pre class="mermaid">graph TD
    subgraph Optimization["Performance Optimization Layers"]
        L1[Initial Load<br/>Code Splitting, Lazy Loading]
        L2[Runtime<br/>Selectors, Memoization]
        L3[Audio<br/>Shared Context, Caching]
        L4[Network<br/>PWA Caching, Prefetch]
    end
    
    L1 --> L2 --> L3 --> L4</pre>
<h2>Build Pipeline</h2>
<pre class="mermaid">flowchart LR
    subgraph Input
        TS[TypeScript]
        TSX[React TSX]
        CSS[Tailwind CSS]
        Assets[Static Assets]
    end
    
    subgraph Vite["Vite Build"]
        SWC[SWC Compiler]
        Rollup[Rollup Bundler]
        PostCSS[PostCSS]
    end
    
    subgraph Output
        JS[Optimized JS Chunks]
        StyleSheet[Minified CSS]
        Static[Hashed Assets]
        SW[Service Worker]
    end
    
    TS --> SWC
    TSX --> SWC
    CSS --> PostCSS
    SWC --> Rollup
    PostCSS --> Rollup
    Assets --> Static
    Rollup --> JS
    Rollup --> StyleSheet
    Rollup --> SW</pre>
<h2>Related Documentation</h2>
<ul><li><a href="/docs/application-framework">Application Framework</a> - App structure and lifecycle</li></ul><ul><li><a href="/docs/state-management">State Management</a> - Zustand stores and persistence</li><li><a href="/docs/api-architecture">API Architecture</a> - Backend API design</li></ul>
      </article>
      
      <nav class="nav">
        <a href="/docs/overview">← Overview</a>
        <a href="/docs/api-architecture">API Architecture →</a>
      </nav>
      
    </main>
  </div>
  
  <script>
    function toggleNavGroup(button) {
      const group = button.closest('.nav-group');
      const children = group.querySelector('.nav-children');
      const svg = button.querySelector('svg');
      const isExpanded = group.classList.contains('expanded');
      
      if (isExpanded) {
        group.classList.remove('expanded');
        children.style.display = 'none';
        svg.style.transform = 'rotate(0deg)';
        button.setAttribute('aria-expanded', 'false');
      } else {
        group.classList.add('expanded');
        children.style.display = 'block';
        svg.style.transform = 'rotate(90deg)';
        button.setAttribute('aria-expanded', 'true');
      }
    }
    
    document.addEventListener('click', (e) => {
      const sidebar = document.querySelector('.sidebar');
      const menuBtn = document.querySelector('.menu-btn');
      const clickedMenuBtn = menuBtn && menuBtn.contains(e.target);
      if (sidebar.classList.contains('open') && !sidebar.contains(e.target) && !clickedMenuBtn) {
        sidebar.classList.remove('open');
      }
    });
  </script>
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11/dist/mermaid.esm.min.mjs';
    mermaid.initialize({
      startOnLoad: true,
      theme: 'base',
      securityLevel: 'loose',
      themeVariables: {
        fontFamily: '"Geneva", system-ui, sans-serif',
        fontSize: '10px',
        primaryColor: '#f0f0f0',
        primaryBorderColor: '#ccc',
        primaryTextColor: '#000',
        lineColor: '#666',
        secondaryColor: '#f8f8f8',
        tertiaryColor: '#fff'
      },
      flowchart: { curve: 'basis', padding: 8, nodeSpacing: 30, rankSpacing: 30 },
      sequence: { actorFontSize: 10, messageFontSize: 10, noteFontSize: 10 }
    });
  </script>
</body>
</html>